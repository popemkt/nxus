# Phase 5.5: UI Migration - Agnostic Node Tools

This phase focuses on building powerful, app-agnostic tools to browse, inspect, and search the node-based architecture. The `/nodes` route serves as the hub for these tools.

## Implementation Status

| Component            | Status      | Notes                              |
| -------------------- | ----------- | ---------------------------------- |
| Node Workbench Route | âœ… Complete | `/nodes` route with 3-pane layout  |
| Node Browser         | âœ… Complete | Search, grouping, keyboard nav     |
| Node Inspector       | âœ… Complete | Properties, backlinks, inline edit |
| Supertag Sidebar     | âœ… Complete | Filter by supertag                 |
| Universal Search     | âœ… Complete | `searchNodesServerFn`              |
| Backlinks API        | âœ… Complete | `getBacklinksServerFn`             |

---

## Implemented Components

### 1. Node Workbench Route (`/nodes`) âœ…

Main route for exploring the node database.

#### [nodes.tsx](file:///c:/workspace/repos/nxus/packages/nxus-core/src/routes/nodes.tsx)

- 3-pane layout: Supertag Sidebar | Node Browser | Node Inspector
- State management for search, selection, and supertag filter
- Keyboard navigation hints

### 2. Node Browser âœ…

#### [NodeBrowser.tsx](file:///c:/workspace/repos/nxus/packages/nxus-core/src/components/features/nodes/node-browser/NodeBrowser.tsx)

- Search bar with instant filtering
- Nodes grouped by supertag (collapsible)
- Keyboard navigation (â†‘â†“ to navigate, Enter to select)
- Stats bar showing node count

### 3. Node Inspector âœ…

#### [NodeInspector.tsx](file:///c:/workspace/repos/nxus/packages/nxus-core/src/components/features/nodes/node-inspector/NodeInspector.tsx)

- **Materialized Properties**: All properties with type-aware rendering
- **Supertag Badges**: Visual display of node's supertags
- **Backlinks**: Query for nodes referencing current node
- **Inline Editing**: Edit node content with pencil icon toggle
- **Navigation**: Clickable node references for hopping between nodes
- **System Info**: systemId, UUIDs, timestamps

### 4. Supertag Sidebar âœ…

#### [SupertagSidebar.tsx](file:///c:/workspace/repos/nxus/packages/nxus-core/src/components/features/nodes/supertag-sidebar/SupertagSidebar.tsx)

- "All Nodes" option to clear filter
- List of available supertags
- Visual selection state

### 5. Server Functions âœ…

#### [search-nodes.server.ts](file:///c:/workspace/repos/nxus/packages/nxus-core/src/services/nodes/search-nodes.server.ts)

- `searchNodesServerFn(query)` - Content search across all nodes
- `getSupertagsServerFn()` - List all supertags
- `getAllNodesServerFn()` - Get nodes with optional supertag filter
- `getBacklinksServerFn(nodeId)` - Get nodes referencing a node

### 6. Shared Components âœ…

#### [shared/](file:///c:/workspace/repos/nxus/packages/nxus-core/src/components/features/nodes/shared/)

- `NodeBadge.tsx` - Compact node display
- `NodeLink.tsx` - Clickable node reference
- `SupertagChip.tsx` - Supertag badge

---

## Phase 2: Outline Editor (Future)

**Goal**: Tana-like hierarchical node editing experience

### Features Needed

| Feature              | Description                                   | Priority        |
| -------------------- | --------------------------------------------- | --------------- |
| Hierarchical view    | Tree of nodes with parent-child relationships | ğŸ”´ Critical     |
| Keyboard navigation  | â†‘â†“ to move between nodes, Enter to edit       | ğŸ”´ Critical     |
| Inline node creation | Enter = new sibling, Tab = new child          | ğŸ”´ Critical     |
| Expand/collapse      | Show/hide child nodes                         | ğŸŸ¡ Medium       |
| Indentation          | Tab/Shift+Tab to indent/outdent               | ğŸŸ¡ Medium       |
| Drag & drop          | Reorder nodes by dragging                     | ğŸŸ¢ Nice to have |

### Editor Technology Research

#### Options Comparison

| Approach                    | Pros                                          | Cons                    | Fit       |
| --------------------------- | --------------------------------------------- | ----------------------- | --------- |
| **Build from scratch**      | Full control, lightweight, matches node model | More dev time           | âš ï¸ Medium |
| **BlockNote** (ProseMirror) | Block-based, drag/drop built-in               | Rich text focused       | ğŸŸ¡ Maybe  |
| **TipTap** (ProseMirror)    | Best nested list support, mature ecosystem    | Bundle size ~150KB      | âœ… Good   |
| **Lexical** (Meta)          | Performance, node-based like ours             | More wiring needed      | âœ… Good   |
| **CodeMirror 6**            | Logseq uses this, syntax highlighting         | Complex for simple case | ğŸŸ¡ Maybe  |
| **Slate**                   | Ultimate flexibility                          | Steep learning curve    | ğŸŸ¡ Maybe  |

#### How Logseq Does It

Logseq uses a **hybrid approach**: CodeMirror for text editing + custom outliner logic on top.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Custom Outliner Logic              â”‚  â† Blocks, nesting, collapse
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            CodeMirror v5                    â”‚  â† Text editing, cursor
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     DataScript (in-memory Datalog DB)       â”‚  â† Query engine
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Markdown Files (local)             â”‚  â† Persistence
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Logseq               | Nxus Equivalent                    |
| -------------------- | ---------------------------------- |
| DataScript (Datalog) | SQLite + `node_properties`         |
| Markdown files       | `nodes` + `node_properties` tables |
| ClojureScript/React  | TypeScript/React                   |

### Recommended Approach

**Start simple, evolve if needed:**

```
Phase 1: Simple contenteditable per block
â”œâ”€â”€ <input> or contenteditable for text
â”œâ”€â”€ Custom keyboard handlers (Tab, Enter, â†‘â†“)
â””â”€â”€ @dnd-kit for drag-and-drop

Phase 2: If rich text needed, upgrade to:
â”œâ”€â”€ CodeMirror 6 per block (syntax highlighting)
â””â”€â”€ Or TipTap per block (rich formatting)
```

### Proposed Files

```
nodes/outline-editor/
â”œâ”€â”€ OutlineEditor.tsx      # Main container
â”œâ”€â”€ OutlineItem.tsx        # Single editable node line
â”œâ”€â”€ useOutlineKeyboard.ts  # Keyboard shortcuts hook
â””â”€â”€ index.ts
```

---

## Phase 3: Query Builder (Future)

**Goal**: Dynamic, saveable searches like Tana's "Search Nodes"

### Features Needed

| Feature          | Description                                   |
| ---------------- | --------------------------------------------- |
| QueryBuilder UI  | Visual interface to build queries with AND/OR |
| Supertag filter  | `has #Tag` condition                          |
| Field conditions | `Status == "Active"`, `Due date < TODAY`      |
| Scope operators  | `OWNED BY`, `CHILD OF`, `DESCENDANTS`         |
| Search Node      | Save query as a node showing live results     |
| Result grouping  | Group results by supertag                     |

### Proposed Files

```
nodes/query-builder/
â”œâ”€â”€ QueryBuilder.tsx       # Main builder UI
â”œâ”€â”€ QueryCondition.tsx     # Single condition row (field, operator, value)
â”œâ”€â”€ FieldSelector.tsx      # Field dropdown
â””â”€â”€ index.ts

services/nodes/
â””â”€â”€ query-builder.server.ts  # Execute saved queries
```

---

## Verification Checklist

### Manual Testing âœ…

1. **Navigation**: Go to `/nodes` â†’ 3-pane layout loads with sidebar, browser, inspector
2. **Search**: Type in search bar â†’ results filtered instantly
3. **Inspection**: Click a node â†’ inspector shows:
   - All materialized properties
   - Supertag badges
   - Backlinks section
   - Clickable node references
4. **Supertag Filtering**: Click supertag in sidebar â†’ browser filters to those nodes
5. **Inline Editing**: Click pencil icon â†’ edit content â†’ save with Enter

### Future Testing

- `backlinks.test.ts` - Test backlink queries return correct nodes
- `search-nodes.test.ts` - Test content search finds nodes

---

## Open Questions (Resolved)

| Question         | Resolution                                      |
| ---------------- | ----------------------------------------------- |
| Priority         | All core features implemented                   |
| Backlinks scope  | Currently shows all (pagination not needed yet) |
| Graph edge types | Deferred to future phase                        |
