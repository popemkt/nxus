# Phase 5.5: UI Migration - Agnostic Node Tools

This phase focuses on building powerful, app-agnostic tools to browse, inspect, and search the node-based architecture. A new `/debug` view will serve as the hub for these tools.

## Proposed Changes

### 1. Debug/Admin View (`/debug`)

A dedicated dashboard for exploring the node database directly.

#### [NEW] [debug.tsx](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/routes/debug.tsx)

- Main route for the node workbench.
- Sidebar with supertag filters and search.
- Main area for the Node Browser and Node Inspector.

#### [NEW] [node-browser.tsx](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/components/features/debug/node-browser.tsx)

- Table/List view of all nodes.
- Column filters for supertags and content.
- Quick navigation to specific nodes.

### 2. Deep Node Inspector

A thoughtful visualization of an [AssembledNode](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/services/nodes/node.service.ts#19-30).

#### [NEW] [node-inspector.tsx](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/components/features/debug/node-inspector.tsx)

- **Materialized Contents**: Render all properties (scalar and JSON).
- **Relationships**:
  - Outgoing: Property values that are node references.
  - Incoming (Backlinks): Dynamic query for nodes referencing the current node.
- **Navigation**:
  - Breadcrumbs based on `ownerId` or `parent` field.
  - Clickable property values to hop between nodes.
- **System Info**: Show `systemId`, UUIDs, and raw DB fields for debugging.

### 3. Supertag Filter & Browser

Agnostic filtering that leverages inheritance.

#### [MODIFY] [nodes.server.ts](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/services/nodes/nodes.server.ts)

- Update `getNodesBySupertagServerFn` to return more metadata needed for the browser.
- Add `getSupertagsServerFn` to list all available supertags (nodes with `#Supertag`).

#### [NEW] [supertag-sidebar.tsx](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/components/features/debug/supertag-sidebar.tsx)

- Tree view of supertags (e.g., `#Item` -> `#Tool`, `#Repo`).
- Real-time filtering of the Node Browser.

### 4. Universal Search

Search across all nodes by content.

#### [NEW] [search-nodes.server.ts](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/services/nodes/search-nodes.server.ts)

- `searchNodesServerFn(query)`: Search `content_plain` across all nodes.
- Group results by supertag for better organization.

---

## Implementation Order

1. **Routing & Basic Debug Layout**: Set up `/debug` and the split paned layout.
2. **Universal Node Browser**: Basic list of all nodes with search.
3. **Deep Node Inspector**: The detailed view for a selected node (materialized props + relations).
4. **Supertag Integration**: Add the supertag tree for advanced filtering.

---

## Verification Plan

### Manual Verification

1. **Navigation**: Go to `/debug` and see the list of all system and user nodes.
2. **Search**: Type in the universal search and see results from Items, Tags, and Fields.
3. **Inspection**: Click a node (e.g., `item:claude-code`) and verify:
   - All properties are listed.
   - You can see it has the `#Tool` supertag.
   - You can click on a tag property value and navigate to that Tag node.
   - Breadcrumbs show the path up to the system root if applicable.
4. **Supertag Filtering**: Select `#Tag` in the sidebar and verify only tag nodes are listed.

---

## Verification Plan

### Automated Tests

Currently limited test coverage exists ([pty-buffer.test.ts](file:///stuff/WorkSpace/Nxus/nxus/packages/nxus-core/src/services/shell/pty-buffer.test.ts) is the only test file). New tests to add:

```bash
# Run existing tests
cd packages/nxus-core && pnpm test
```

For each feature, add integration tests:

- `backlinks.test.ts` - Test backlink queries return correct nodes
- `search-nodes.test.ts` - Test content search finds nodes

### Manual Verification

> [!IMPORTANT]
> The following manual tests should be performed with `NODE_BASED_ARCHITECTURE_ENABLED=true` to test the new code paths.

#### Backlinks Panel

1. Start app: `NODE_BASED_ARCHITECTURE_ENABLED=true npx nx dev nxus-core`
2. Navigate to a tag detail page (e.g., click a tag in any item)
3. Verify "Items with this tag" section shows items using that tag
4. Click an item link â†’ should navigate to item detail

#### Graph View

1. Switch to Graph view in gallery
2. Verify edges appear between items based on dependencies
3. Verify different edge styles for different relationship types (if implemented)

#### Node Inspector (Dev Mode only)

1. Enable dev mode in settings
2. Navigate to any item detail page
3. Click "Inspect Node" in the dev toolbar
4. Verify modal shows all node properties, supertags, and backlinks

---

## Questions for User

1. **Priority**: Would you like to implement all 5 features, or focus on a subset first?
2. **Backlinks scope**: For "Items with this tag", should we show all items or paginate/limit?
3. **Graph edge types**: Should different relationship types (deps/tags/commands) have distinct visual styles (colors, dash patterns)?
